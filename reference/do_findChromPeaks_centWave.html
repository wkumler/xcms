<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Core API function for centWave peak detection — do_findChromPeaks_centWave • xcms</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Core API function for centWave peak detection — do_findChromPeaks_centWave" />
<meta property="og:description" content="This function performs peak density and wavelet based
    chromatographic peak detection for high resolution LC/MS data in centroid
    mode [Tautenhahn 2008]." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/new_functionality.html">New and modified functionality in xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sneumann/xcms/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Core API function for centWave peak detection</h1>
    <small class="dont-index">Source: <a href='https://github.com/sneumann/xcms/blob/master/R/do_findChromPeaks-functions.R'><code>R/do_findChromPeaks-functions.R</code></a></small>
    <div class="hidden name"><code>do_findChromPeaks_centWave.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function performs peak density and wavelet based
    chromatographic peak detection for high resolution LC/MS data in centroid
    mode [Tautenhahn 2008].</p>
    </div>

    <pre class="usage"><span class='fu'>do_findChromPeaks_centWave</span>(
  <span class='no'>mz</span>,
  <span class='no'>int</span>,
  <span class='no'>scantime</span>,
  <span class='no'>valsPerSpect</span>,
  <span class='kw'>ppm</span> <span class='kw'>=</span> <span class='fl'>25</span>,
  <span class='kw'>peakwidth</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>20</span>, <span class='fl'>50</span>),
  <span class='kw'>snthresh</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>prefilter</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>3</span>, <span class='fl'>100</span>),
  <span class='kw'>mzCenterFun</span> <span class='kw'>=</span> <span class='st'>"wMean"</span>,
  <span class='kw'>integrate</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>mzdiff</span> <span class='kw'>=</span> -<span class='fl'>0.001</span>,
  <span class='kw'>fitgauss</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>noise</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>verboseColumns</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>roiList</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>firstBaselineCheck</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>roiScales</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>sleep</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>extendLengthMSW</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mz</th>
      <td><p>Numeric vector with the individual m/z values from all scans/
spectra of one file/sample.</p></td>
    </tr>
    <tr>
      <th>int</th>
      <td><p>Numeric vector with the individual intensity values from all
scans/spectra of one file/sample.</p></td>
    </tr>
    <tr>
      <th>scantime</th>
      <td><p>Numeric vector of length equal to the number of
spectra/scans of the data representing the retention time of each scan.</p></td>
    </tr>
    <tr>
      <th>valsPerSpect</th>
      <td><p>Numeric vector with the number of values for each
spectrum.</p></td>
    </tr>
    <tr>
      <th>ppm</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the maximal tolerated m/z deviation in
consecutive scans in parts per million (ppm) for the initial ROI
definition.</p></td>
    </tr>
    <tr>
      <th>peakwidth</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(2)</a></code> with the expected approximate
peak width in chromatographic space. Given as a range (min, max)
in seconds.</p></td>
    </tr>
    <tr>
      <th>snthresh</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the signal to noise ratio cutoff.</p></td>
    </tr>
    <tr>
      <th>prefilter</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(2)</a></code>: <code><a href='https://rdrr.io/r/base/c.html'>c(k, I)</a></code> specifying the prefilter
step for the first analysis step (ROI detection). Mass traces are only
retained if they contain at least <code>k</code> peaks with intensity
<code>&gt;= I</code>.</p></td>
    </tr>
    <tr>
      <th>mzCenterFun</th>
      <td><p>Name of the function to calculate the m/z center of the
chromatographic peak. Allowed are: <code>"wMean"</code>: intensity weighted
mean of the peak's m/z values, <code>"mean"</code>: mean of the peak's m/z
values, <code>"apex"</code>: use the m/z value at the peak apex,
<code>"wMeanApex3"</code>: intensity weighted mean of the m/z value at the
peak apex and the m/z values left and right of it and <code>"meanApex3"</code>:
mean of the m/z value of the peak apex and the m/z values left and right
of it.</p></td>
    </tr>
    <tr>
      <th>integrate</th>
      <td><p>Integration method. For <code>integrate = 1</code> peak limits
are found through descent on the mexican hat filtered data, for
<code>integrate = 2</code> the descent is done on the real data. The latter
method is more accurate but prone to noise, while the former is more
robust, but less exact.</p></td>
    </tr>
    <tr>
      <th>mzdiff</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> representing the minimum difference in m/z
dimension required for peaks with overlapping retention times; can be
negative to allow overlap. During peak post-processing, peaks
defined to be overlapping are reduced to the one peak with the largest
signal.</p></td>
    </tr>
    <tr>
      <th>fitgauss</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> whether or not a Gaussian should be fitted
to each peak. This affects mostly the retention time position of the
peak.</p></td>
    </tr>
    <tr>
      <th>noise</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> allowing to set a minimum intensity required
for centroids to be considered in the first analysis step (centroids with
intensity <code>&lt; noise</code> are omitted from ROI detection).</p></td>
    </tr>
    <tr>
      <th>verboseColumns</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> whether additional peak meta data
columns should be returned.</p></td>
    </tr>
    <tr>
      <th>roiList</th>
      <td><p>An optional list of regions-of-interest (ROI) representing
detected mass traces. If ROIs are submitted the first analysis step is
omitted and chromatographic peak detection is performed on the submitted
ROIs. Each ROI is expected to have the following elements specified:
<code>scmin</code> (start scan index), <code>scmax</code> (end scan index),
<code>mzmin</code> (minimum m/z), <code>mzmax</code> (maximum m/z), <code>length</code>
(number of scans), <code>intensity</code> (summed intensity). Each ROI should
be represented by a <code>list</code> of elements or a single row
<code>data.frame</code>.</p></td>
    </tr>
    <tr>
      <th>firstBaselineCheck</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>. If <code>TRUE</code> continuous
data within regions of interest is checked to be above the first baseline.</p></td>
    </tr>
    <tr>
      <th>roiScales</th>
      <td><p>Optional numeric vector with length equal to <code>roiList</code>
defining the scale for each region of interest in <code>roiList</code> that
should be used for the centWave-wavelets.</p></td>
    </tr>
    <tr>
      <th>sleep</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the number of seconds to wait between
iterations. Defaults to <code>sleep = 0</code>. If <code>&gt; 0</code> a plot is
generated visualizing the identified chromatographic peak. Note: this
argument is for backward compatibility only and will be removed in
future.</p></td>
    </tr>
    <tr>
      <th>extendLengthMSW</th>
      <td><p>Option to force centWave to use all scales when 
running centWave rather than truncating with the EIC length. Uses the "open"
method to extend the EIC to a integer base-2 length prior to being passed to 
<code>convolve</code> rather than the default "reflect" method. See 
https://github.com/sneumann/xcms/issues/445 for more information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix, each row representing an identified chromatographic peak,
    with columns:</p><dl>

    <dt>mz</dt><dd><p>Intensity weighted mean of m/z values of the peak across
    scans.</p></dd>
    <dt>mzmin</dt><dd><p>Minimum m/z of the peak.</p></dd>
    <dt>mzmax</dt><dd><p>Maximum m/z of the peak.</p></dd>
    <dt>rt</dt><dd><p>Retention time of the peak's midpoint.</p></dd>
    <dt>rtmin</dt><dd><p>Minimum retention time of the peak.</p></dd>
    <dt>rtmax</dt><dd><p>Maximum retention time of the peak.</p></dd>
    <dt>into</dt><dd><p>Integrated (original) intensity of the peak.</p></dd>
    <dt>intb</dt><dd><p>Per-peak baseline corrected integrated peak intensity.</p></dd>
    <dt>maxo</dt><dd><p>Maximum intensity of the peak.</p></dd>
    <dt>sn</dt><dd><p>Signal to noise ratio, defined as <code>(maxo - baseline)/sd</code>,
    <code>sd</code> being the standard deviation of local chromatographic noise.</p></dd>
    <dt>egauss</dt><dd><p>RMSE of Gaussian fit.</p></dd>
    
</dl><p>Additional columns for <code>verboseColumns = TRUE</code>:</p><dl>

    <dt>mu</dt><dd><p>Gaussian parameter mu.</p></dd>
    <dt>sigma</dt><dd><p>Gaussian parameter sigma.</p></dd>
    <dt>h</dt><dd><p>Gaussian parameter h.</p></dd>
    <dt>f</dt><dd><p>Region number of the m/z ROI where the peak was localized.</p></dd>
    <dt>dppm</dt><dd><p>m/z deviation of mass trace across scans in ppm.</p></dd>
    <dt>scale</dt><dd><p>Scale on which the peak was localized.</p></dd>
    <dt>scpos</dt><dd><p>Peak position found by wavelet analysis (scan number).</p></dd>
    <dt>scmin</dt><dd><p>Left peak limit found by wavelet analysis (scan number).</p></dd>
    <dt>scmax</dt><dd><p>Right peak limit found by wavelet analysis (scan numer).</p></dd>
    
</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This algorithm is most suitable for high resolution
LC/{TOF,OrbiTrap,FTICR}-MS data in centroid mode. In the first phase
the method identifies <em>regions of interest</em> (ROIs) representing
mass traces that are characterized as regions with less than <code>ppm</code>
m/z deviation in consecutive scans in the LC/MS map. In detail, starting
with a single m/z, a ROI is extended if a m/z can be found in the next scan
(spectrum) for which the difference to the mean m/z of the ROI is smaller
than the user defined <code>ppm</code> of the m/z. The mean m/z of the ROI is then
updated considering also the newly included m/z value.</p>
<p>These ROIs are then, after some cleanup, analyzed using continuous wavelet
transform (CWT) to locate chromatographic peaks on different scales. The
first analysis step is skipped, if regions of interest are passed with
the <code>roiList</code> parameter.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The <em>centWave</em> was designed to work on centroided mode, thus it
    is expected that such data is presented to the function.</p>
<p>This function exposes core chromatographic peak detection functionality
    of the <em>centWave</em> method. While this function can be called
    directly, users will generally call the corresponding method for the
    data object instead.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ralf Tautenhahn, Christoph B\"ottcher, and Steffen Neumann "Highly
    sensitive feature detection for high resolution LC/MS"
    <em>BMC Bioinformatics</em> 2008, 9:504</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='findChromPeaks-centWave.html'>centWave</a></code> for the standard user interface method.</p>
<p>Other core peak detection functions: 
<code><a href='do_findChromPeaks_centWaveWithPredIsoROIs.html'>do_findChromPeaks_centWaveWithPredIsoROIs</a>()</code>,
<code><a href='do_findChromPeaks_massifquant.html'>do_findChromPeaks_massifquant</a>()</code>,
<code><a href='do_findChromPeaks_matchedFilter.html'>do_findChromPeaks_matchedFilter</a>()</code>,
<code><a href='do_findPeaks_MSW.html'>do_findPeaks_MSW</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Load the test file</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>faahKO</span>)
<span class='no'>fs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>'cdf/KO/ko15.CDF'</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"faahKO"</span>)
<span class='no'>xr</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xcmsRaw.html'>xcmsRaw</a></span>(<span class='no'>fs</span>, <span class='kw'>profstep</span> <span class='kw'>=</span> <span class='fl'>0</span>)

<span class='co'>## Extracting the data from the xcmsRaw for do_findChromPeaks_centWave</span>
<span class='no'>mzVals</span> <span class='kw'>&lt;-</span> <span class='no'>xr</span>@<span class='kw'>env</span>$<span class='no'>mz</span>
<span class='no'>intVals</span> <span class='kw'>&lt;-</span> <span class='no'>xr</span>@<span class='kw'>env</span>$<span class='no'>intensity</span>
<span class='co'>## Define the values per spectrum:</span>
<span class='no'>valsPerSpect</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>xr</span>@<span class='kw'>scanindex</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>mzVals</span>)))

<span class='co'>## Calling the function. We're using a large value for noise to speed up</span>
<span class='co'>## the call in the example performance - in a real use case we would either</span>
<span class='co'>## set the value to a reasonable value or use the default value.</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>do_findChromPeaks_centWave</span>(<span class='kw'>mz</span> <span class='kw'>=</span> <span class='no'>mzVals</span>, <span class='kw'>int</span> <span class='kw'>=</span> <span class='no'>intVals</span>,
<span class='kw'>scantime</span> <span class='kw'>=</span> <span class='no'>xr</span>@<span class='kw'>scantime</span>, <span class='kw'>valsPerSpect</span> <span class='kw'>=</span> <span class='no'>valsPerSpect</span>, <span class='kw'>noise</span> <span class='kw'>=</span> <span class='fl'>10000</span>)</div><div class='output co'>#&gt; <span class='message'>Detecting mass traces at 25 ppm ... </span></div><div class='output co'>#&gt; <span class='message'>OK</span></div><div class='output co'>#&gt; <span class='message'>Detecting chromatographic peaks in 937 regions of interest ...</span></div><div class='output co'>#&gt; <span class='message'> OK: 292 found.</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>res</span>)</div><div class='output co'>#&gt;         mz mzmin mzmax       rt    rtmin    rtmax      into      intb   maxo
#&gt; [1,] 453.2 453.2 453.2 2506.073 2501.378 2527.982 1007409.0 1007380.8  38152
#&gt; [2,] 307.0 307.0 307.0 2618.750 2592.145 2645.354  284782.4  268039.8  16872
#&gt; [3,] 302.0 302.0 302.0 2617.185 2595.275 2640.659  687146.6  671297.8  30552
#&gt; [4,] 360.0 360.0 360.0 2682.913 2668.828 2698.562 5641322.3 5420634.7 317568
#&gt; [5,] 361.1 361.1 361.1 2684.478 2665.698 2698.562 1158340.2 1116522.0  72272
#&gt; [6,] 416.1 416.1 416.1 2682.913 2635.964 2709.517  487698.6  446552.1  12036
#&gt;         sn
#&gt; [1,] 38151
#&gt; [2,]    20
#&gt; [3,]    46
#&gt; [4,]    11
#&gt; [5,]    11
#&gt; [6,]    11</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Steffen Neumann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


