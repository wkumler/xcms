<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract ion chromatograms for each feature — featureChromatograms • xcms</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract ion chromatograms for each feature — featureChromatograms" />
<meta property="og:description" content="Extract ion chromatograms for features in an XCMSnExp object. The
function returns for each feature its extracted ion chromatogram and all
associated peaks with it. The chromatogram is extracted from the m/z - rt
region including all chromatographic peaks of that features (i.e. based on
the ranges of &quot;mzmin&quot;, &quot;mzmax&quot;, &quot;rtmin&quot;, &quot;rtmax&quot; of all
chromatographic peaks of the feature).
By default only chromatographic peaks associated with a feature are included
for an extracted ion chromatogram (parameter include = &quot;feature_only&quot;). By
setting include = &quot;apex_within&quot; all chromatographic peaks (and eventually
the feature which they are part of - if feature definitions are present)
that have their apex position within the m/z - rt range from which the
chromatogram is extracted are returned too.
With include = &quot;any&quot; or include = &quot;all&quot; all chromatographic peaks (and
eventually the feature in which they are present) overlapping the m/z and rt
range will be returned." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.13.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sneumann/xcms/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract ion chromatograms for each feature</h1>
    <small class="dont-index">Source: <a href='https://github.com/sneumann/xcms/blob/master/R/functions-XCMSnExp.R'><code>R/functions-XCMSnExp.R</code></a></small>
    <div class="hidden name"><code>featureChromatograms.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extract ion chromatograms for features in an <a href='XCMSnExp-class.html'>XCMSnExp</a> object. The
function returns for each feature its extracted ion chromatogram and all
associated peaks with it. The chromatogram is extracted from the m/z - rt
region including all chromatographic peaks of that features (i.e. based on
the ranges of <code>"mzmin"</code>, <code>"mzmax"</code>, <code>"rtmin"</code>, <code>"rtmax"</code> of all
chromatographic peaks of the feature).</p>
<p>By default only chromatographic peaks associated with a feature are included
for an extracted ion chromatogram (parameter <code>include = "feature_only"</code>). By
setting <code>include = "apex_within"</code> all chromatographic peaks (and eventually
the feature which they are part of - if feature definitions are present)
that have their apex position within the m/z - rt range from which the
chromatogram is extracted are returned too.
With <code>include = "any"</code> or <code>include = "all"</code> all chromatographic peaks (and
eventually the feature in which they are present) overlapping the m/z and rt
range will be returned.</p>
    </div>

    <pre class="usage"><span class='fu'>featureChromatograms</span><span class='op'>(</span>
  <span class='va'>x</span>,
  expandRt <span class='op'>=</span> <span class='fl'>0</span>,
  aggregationFun <span class='op'>=</span> <span class='st'>"max"</span>,
  <span class='va'>features</span>,
  include <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"feature_only"</span>, <span class='st'>"apex_within"</span>, <span class='st'>"any"</span>, <span class='st'>"all"</span><span class='op'>)</span>,
  filled <span class='op'>=</span> <span class='cn'>FALSE</span>,
  n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'>fileNames</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>,
  value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"maxo"</span>, <span class='st'>"into"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>XCMSnExp</code> object with grouped chromatographic peaks.</p></td>
    </tr>
    <tr>
      <th>expandRt</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> to expand the retention time range for each
chromatographic peak by a constant value on each side.</p></td>
    </tr>
    <tr>
      <th>aggregationFun</th>
      <td><p><code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> specifying the name that should be
used to aggregate intensity values across the m/z value range for
the same retention time. The default <code>"sum"</code> returns a base peak
chromatogram.</p></td>
    </tr>
    <tr>
      <th>features</th>
      <td><p><code>integer</code>, <code>character</code> or <code>logical</code> defining a subset of
features for which chromatograms should be returned. Can be the index
of the features in <code>featureDefinitions</code>, feature IDs (row names of
<code>featureDefinitions</code>) or a logical vector.</p></td>
    </tr>
    <tr>
      <th>include</th>
      <td><p><code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> defining which chromatographic peaks (and
related feature definitions) should be included in the returned
<code><a href='XChromatograms.html'>XChromatograms()</a></code>. Defaults to <code>"feature_only"</code>; See description above
for options and details.</p></td>
    </tr>
    <tr>
      <th>filled</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> whether filled-in peaks should be included in
the result object. The default is <code>filled = FALSE</code>, i.e. only detected
peaks are reported.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p><code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code> to optionally specify the number of <em>top n</em> samples
from which the EIC should be extracted.</p></td>
    </tr>
    <tr>
      <th>value</th>
      <td><p><code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> specifying the column to be used to sort the
samples. Can be either <code>"maxo"</code> (the default) or <code>"into"</code> to use the
maximal peak intensity or the integrated peak area, respectively.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>optional arguments to be passed along to the <code><a href='chromatogram,XCMSnExp-method.html'>chromatogram()</a></code>
function.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='XChromatograms.html'>XChromatograms()</a></code> object.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>When extracting EICs from only the top <code>n</code> samples it can happen that one
or more of the features specified with <code>features</code> are dropped because they
have no detected peak in the <em>top n</em> samples. The chance for this to happen
is smaller if <code>x</code> contains also filled-in peaks (with <code>fillChromPeaks</code>).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='filterColumnsIntensityAbove,MChromatograms-method.html'>filterColumnsKeepTop()</a></code> to filter the extracted EICs keeping only
the <em>top n</em> columns (samples) with the highest intensity.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Johannes Rainer</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>## Load a test data set with detected peaks</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>faahko_sub</span><span class='op'>)</span>
<span class='co'>## Update the path to the files for the local system</span>
<span class='fu'><a href='dirname.html'>dirname</a></span><span class='op'>(</span><span class='va'>faahko_sub</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"cdf/KO"</span>, package <span class='op'>=</span> <span class='st'>"faahKO"</span><span class='op'>)</span>

<span class='co'>## Disable parallel processing for this example</span>
<span class='fu'>register</span><span class='op'>(</span><span class='fu'>SerialParam</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Subset the object to a smaller retention time range</span>
<span class='va'>xdata</span> <span class='op'>&lt;-</span> <span class='fu'>filterRt</span><span class='op'>(</span><span class='va'>faahko_sub</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2500</span>, <span class='fl'>3500</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>xdata</span> <span class='op'>&lt;-</span> <span class='fu'><a href='groupChromPeaks.html'>groupChromPeaks</a></span><span class='op'>(</span><span class='va'>xdata</span>,
    param <span class='op'>=</span> <span class='fu'><a href='groupChromPeaks-density.html'>PeakDensityParam</a></span><span class='op'>(</span>minFraction <span class='op'>=</span> <span class='fl'>0.8</span>, sampleGroups <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Processing 2416 mz slices ... </span></div><div class='output co'>#&gt; <span class='message'>OK</span></div><div class='input'>
<span class='co'>## Get the feature definitions</span>
<span class='fu'><a href='XCMSnExp-class.html'>featureDefinitions</a></span><span class='op'>(</span><span class='va'>xdata</span><span class='op'>)</span>
</div><div class='output co'>#&gt; DataFrame with 11 rows and 10 columns
#&gt;          mzmed     mzmin     mzmax     rtmed     rtmin     rtmax    npeaks
#&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;
#&gt; FT01     300.2     300.2     300.2   3387.14   3379.32   3390.27         4
#&gt; FT02     301.0     301.0     301.0   2787.77   2786.20   2792.46         3
#&gt; FT03     326.2     326.2     326.2   3416.88   3415.31   3424.70         3
#&gt; FT04     343.0     343.0     343.0   2684.48   2678.22   2686.04         3
#&gt; FT05     344.0     344.0     344.0   2682.91   2679.78   2686.04         3
#&gt; FT06     365.0     365.0     365.0   2684.48   2679.78   2686.04         3
#&gt; FT07     496.2     496.2     496.2   3335.50   3316.72   3340.19         3
#&gt; FT08     496.2     496.2     496.2   3402.79   3384.01   3410.62         3
#&gt; FT09     522.2     522.2     522.2   3387.14   3344.89   3434.09         6
#&gt; FT10     523.2     523.2     523.2   3387.14   3344.89   3434.09         6
#&gt; FT11     532.2     532.2     532.2   3482.61   3476.34   3488.86         3
#&gt;             X1         peakidx  ms_level
#&gt;      &lt;numeric&gt;          &lt;list&gt; &lt;integer&gt;
#&gt; FT01         3  35, 91,129,...         1
#&gt; FT02         3      10, 63,117         1
#&gt; FT03         3      37, 94,132         1
#&gt; FT04         3       6, 58,114         1
#&gt; FT05         3       3, 56,112         1
#&gt; FT06         3       7, 59,115         1
#&gt; FT07         3      47,103,138         1
#&gt; FT08         3      48,104,139         1
#&gt; FT09         3  52, 53,105,...         1
#&gt; FT10         3    38,39,97,...         1
#&gt; FT11         3      49,102,137         1</div><div class='input'>
<span class='co'>## Extract ion chromatograms for the first 3 features. Parameter</span>
<span class='co'>## `features` can be either the feature IDs or feature indices.</span>
<span class='va'>chrs</span> <span class='op'>&lt;-</span> <span class='fu'>featureChromatograms</span><span class='op'>(</span><span class='va'>xdata</span>, features <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>

<span class='co'>## Plot the XIC for the first feature using different colors for each file</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>chrs</span><span class='op'>[</span><span class='fl'>1</span>, <span class='op'>]</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"red"</span>, <span class='st'>"green"</span>, <span class='st'>"blue"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='featureChromatograms-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Steffen Neumann.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9000.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


