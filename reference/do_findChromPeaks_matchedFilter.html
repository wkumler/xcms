<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Core API function for matchedFilter peak detection — do_findChromPeaks_matchedFilter • xcms</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Core API function for matchedFilter peak detection — do_findChromPeaks_matchedFilter" />
<meta property="og:description" content="This function identifies peaks in the chromatographic
    time domain as described in [Smith 2006]. The intensity values are
    binned by cutting The LC/MS data into slices (bins) of a mass unit
    (binSize m/z) wide. Within each bin the maximal intensity is
    selected. The peak detection is then performed in each bin by
    extending it based on the steps parameter to generate slices
    comprising bins current_bin - steps +1 to
    current_bin + steps - 1.
    Each of these slices is then filtered with matched filtration using
    a second-derative Gaussian as the model peak shape. After filtration
    peaks are detected using a signal-to-ration cut-off. For more details
    and illustrations see [Smith 2006]." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/new_functionality.html">New and modified functionality in xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sneumann/xcms/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Core API function for matchedFilter peak detection</h1>
    <small class="dont-index">Source: <a href='https://github.com/sneumann/xcms/blob/master/R/do_findChromPeaks-functions.R'><code>R/do_findChromPeaks-functions.R</code></a></small>
    <div class="hidden name"><code>do_findChromPeaks_matchedFilter.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function identifies peaks in the chromatographic
    time domain as described in [Smith 2006]. The intensity values are
    binned by cutting The LC/MS data into slices (bins) of a mass unit
    (<code>binSize</code> m/z) wide. Within each bin the maximal intensity is
    selected. The peak detection is then performed in each bin by
    extending it based on the <code>steps</code> parameter to generate slices
    comprising bins <code>current_bin - steps +1</code> to
    <code>current_bin + steps - 1</code>.
    Each of these slices is then filtered with matched filtration using
    a second-derative Gaussian as the model peak shape. After filtration
    peaks are detected using a signal-to-ration cut-off. For more details
    and illustrations see [Smith 2006].</p>
    </div>

    <pre class="usage"><span class='fu'>do_findChromPeaks_matchedFilter</span>(
  <span class='no'>mz</span>,
  <span class='no'>int</span>,
  <span class='no'>scantime</span>,
  <span class='no'>valsPerSpect</span>,
  <span class='kw'>binSize</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
  <span class='kw'>impute</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
  <span class='no'>baseValue</span>,
  <span class='no'>distance</span>,
  <span class='kw'>fwhm</span> <span class='kw'>=</span> <span class='fl'>30</span>,
  <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='no'>fwhm</span>/<span class='fl'>2.3548</span>,
  <span class='kw'>max</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>snthresh</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>steps</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>mzdiff</span> <span class='kw'>=</span> <span class='fl'>0.8</span> - <span class='no'>binSize</span> * <span class='no'>steps</span>,
  <span class='kw'>index</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>sleep</span> <span class='kw'>=</span> <span class='fl'>0</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mz</th>
      <td><p>Numeric vector with the individual m/z values from all scans/
spectra of one file/sample.</p></td>
    </tr>
    <tr>
      <th>int</th>
      <td><p>Numeric vector with the individual intensity values from all
scans/spectra of one file/sample.</p></td>
    </tr>
    <tr>
      <th>scantime</th>
      <td><p>Numeric vector of length equal to the number of
spectra/scans of the data representing the retention time of each scan.</p></td>
    </tr>
    <tr>
      <th>valsPerSpect</th>
      <td><p>Numeric vector with the number of values for each
spectrum.</p></td>
    </tr>
    <tr>
      <th>binSize</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> specifying the width of the
bins/slices in m/z dimension.</p></td>
    </tr>
    <tr>
      <th>impute</th>
      <td><p>Character string specifying the method to be used for missing
value imputation. Allowed values are <code>"none"</code> (no linear
interpolation), <code>"lin"</code> (linear interpolation), <code>"linbase"</code>
(linear interpolation within a certain bin-neighborhood) and
<code>"intlin"</code>. See <code><a href='imputeLinInterpol.html'>imputeLinInterpol</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>baseValue</th>
      <td><p>The base value to which empty elements should be set. This
is only considered for <code>method = "linbase"</code> and corresponds to the
<code>profBinLinBase</code>'s <code>baselevel</code> argument.</p></td>
    </tr>
    <tr>
      <th>distance</th>
      <td><p>For <code>method = "linbase"</code>: number of non-empty
neighboring element of an empty element that should be considered for
linear interpolation. See details section for more information.</p></td>
    </tr>
    <tr>
      <th>fwhm</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> specifying the full width at half maximum
of matched filtration gaussian model peak. Only used to calculate the
actual sigma, see below.</p></td>
    </tr>
    <tr>
      <th>sigma</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> specifying the standard deviation (width)
of the matched filtration model peak.</p></td>
    </tr>
    <tr>
      <th>max</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> representing the maximum number of peaks
that are expected/will be identified per slice.</p></td>
    </tr>
    <tr>
      <th>snthresh</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the signal to noise ratio cutoff.</p></td>
    </tr>
    <tr>
      <th>steps</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the number of bins to be
merged before filtration (i.e. the number of neighboring bins that will
be joined to the slice in which filtration and peak detection will be
performed).</p></td>
    </tr>
    <tr>
      <th>mzdiff</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> representing the minimum difference in m/z
dimension required for peaks with overlapping retention times; can be
negative to allow overlap. During peak post-processing, peaks
defined to be overlapping are reduced to the one peak with the largest
signal.</p></td>
    </tr>
    <tr>
      <th>index</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> specifying whether indicies should be
returned instead of values for m/z and retention times.</p></td>
    </tr>
    <tr>
      <th>sleep</th>
      <td><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the number of seconds to wait between
iterations. Defaults to <code>sleep = 0</code>. If <code>&gt; 0</code> a plot is
generated visualizing the identified chromatographic peak. Note: this
argument is for backward compatibility only and will be removed in
future.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix, each row representing an identified chromatographic peak,
    with columns:</p><dl>
    <dt>mz</dt><dd><p>Intensity weighted mean of m/z values of the peak across scans.</p></dd>
    <dt>mzmin</dt><dd><p>Minimum m/z of the peak.</p></dd>
    <dt>mzmax</dt><dd><p>Maximum m/z of the peak.</p></dd>
    <dt>rt</dt><dd><p>Retention time of the peak's midpoint.</p></dd>
    <dt>rtmin</dt><dd><p>Minimum retention time of the peak.</p></dd>
    <dt>rtmax</dt><dd><p>Maximum retention time of the peak.</p></dd>
    <dt>into</dt><dd><p>Integrated (original) intensity of the peak.</p></dd>
    <dt>intf</dt><dd><p>Integrated intensity of the filtered peak.</p></dd>
    <dt>maxo</dt><dd><p>Maximum intensity of the peak.</p></dd>
    <dt>maxf</dt><dd><p>Maximum intensity of the filtered peak.</p></dd>
    <dt>i</dt><dd><p>Rank of peak in merged EIC (<code>&lt;= max</code>).</p></dd>
    <dt>sn</dt><dd><p>Signal to noise ratio of the peak</p></dd>
    
</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The intensities are binned by the provided m/z values within each
    spectrum (scan). Binning is performed such that the bins are centered
    around the m/z values (i.e. the first bin includes all m/z values between
    <code>min(mz) - bin_size/2</code> and <code>min(mz) + bin_size/2</code>).</p>
<p>For more details on binning and missing value imputation see
    <code><a href='binYonX.html'>binYonX</a></code> and <code><a href='imputeLinInterpol.html'>imputeLinInterpol</a></code> methods.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>This function exposes core peak detection functionality of
    the <em>matchedFilter</em> method. While this function can be called
    directly, users will generally call the corresponding method for the
    data object instead (e.g. the <code>link{findPeaks.matchedFilter}</code>
    method).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Colin A. Smith, Elizabeth J. Want, Grace O'Maille, Ruben Abagyan and
Gary Siuzdak. "XCMS: Processing Mass Spectrometry Data for Metabolite
Profiling Using Nonlinear Peak Alignment, Matching, and Identification"
<em>Anal. Chem.</em> 2006, 78:779-787.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='binYonX.html'>binYonX</a></code> for a binning function,
    <code><a href='imputeLinInterpol.html'>imputeLinInterpol</a></code> for the interpolation of missing values.
    <code><a href='findChromPeaks-matchedFilter.html'>matchedFilter</a></code> for the standard user interface method.</p>
<p>Other core peak detection functions: 
<code><a href='do_findChromPeaks_centWaveWithPredIsoROIs.html'>do_findChromPeaks_centWaveWithPredIsoROIs</a>()</code>,
<code><a href='do_findChromPeaks_centWave.html'>do_findChromPeaks_centWave</a>()</code>,
<code><a href='do_findChromPeaks_massifquant.html'>do_findChromPeaks_massifquant</a>()</code>,
<code><a href='do_findPeaks_MSW.html'>do_findPeaks_MSW</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Load the test file</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>faahKO</span>)
<span class='no'>fs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>'cdf/KO/ko15.CDF'</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"faahKO"</span>)
<span class='no'>xr</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xcmsRaw.html'>xcmsRaw</a></span>(<span class='no'>fs</span>)</div><div class='output co'>#&gt; <span class='message'>Create profile matrix with method 'bin' and step 1 ... </span></div><div class='output co'>#&gt; <span class='message'>OK</span></div><div class='input'>
<span class='co'>## Extracting the data from the xcmsRaw for do_findChromPeaks_centWave</span>
<span class='no'>mzVals</span> <span class='kw'>&lt;-</span> <span class='no'>xr</span>@<span class='kw'>env</span>$<span class='no'>mz</span>
<span class='no'>intVals</span> <span class='kw'>&lt;-</span> <span class='no'>xr</span>@<span class='kw'>env</span>$<span class='no'>intensity</span>
<span class='co'>## Define the values per spectrum:</span>
<span class='no'>valsPerSpect</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>xr</span>@<span class='kw'>scanindex</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>mzVals</span>)))

<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>do_findChromPeaks_matchedFilter</span>(<span class='kw'>mz</span> <span class='kw'>=</span> <span class='no'>mzVals</span>, <span class='kw'>int</span> <span class='kw'>=</span> <span class='no'>intVals</span>,
<span class='kw'>scantime</span> <span class='kw'>=</span> <span class='no'>xr</span>@<span class='kw'>scantime</span>, <span class='kw'>valsPerSpect</span> <span class='kw'>=</span> <span class='no'>valsPerSpect</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>res</span>)</div><div class='output co'>#&gt;            mz mzmin mzmax       rt    rtmin    rtmax       into      intf  maxo
#&gt; [1,] 200.1000 200.1 200.1 2928.610 2912.961 2942.695  147887.53  290506.9  9687
#&gt; [2,] 201.0638 201.0 201.1 2531.112 2515.463 2549.892  204572.42  280386.0  7726
#&gt; [3,] 205.0000 205.0 205.0 2784.635 2770.550 2800.284 1778568.94 3610059.7 84280
#&gt; [4,] 205.9819 205.9 206.0 2786.200 2772.115 2800.284  237993.62  448580.0 10681
#&gt; [5,] 207.0821 207.0 207.1 2712.647 2698.562 2726.731  380873.05  730980.9 18800
#&gt; [6,] 208.0671 208.0 208.1 2640.659 2625.009 2656.308   96070.72  150033.4  4112
#&gt;            maxf i       sn
#&gt; [1,]  15899.054 1 13.40257
#&gt; [2,]  13300.725 1 12.13748
#&gt; [3,] 195026.431 1 70.14981
#&gt; [4,]  23860.099 1 31.89939
#&gt; [5,]  40065.736 1 23.89175
#&gt; [6,]   7560.078 1 12.67485</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Steffen Neumann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


