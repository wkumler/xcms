<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grouping FTICR-MS data with xcms â€¢ xcms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Grouping FTICR-MS data with xcms">
<meta property="og:description" content="xcms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.13.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sneumann/xcms/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="xcms-direct-injection_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Grouping FTICR-MS data with xcms</h1>
                        <h4 data-toc-skip class="author">Joachim Bargsten</h4>
                                    <h4 data-toc-skip class="author">Johannes Rainer</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/master/vignettes/xcms-direct-injection.Rmd" class="external-link"><code>vignettes/xcms-direct-injection.Rmd</code></a></small>
      <div class="hidden name"><code>xcms-direct-injection.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document describes how to use <em><a href="https://bioconductor.org/packages/3.13/xcms" class="external-link">xcms</a></em> for the analysis of direct injection mass spec data, including peak detection, calibration and correspondence (grouping of peaks across samples).</p>
</div>
<div id="peak-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#peak-detection" class="anchor"></a>Peak detection</h1>
<p>Prior to any other analysis step, peaks have to be identified in the mass spec data. In contrast to the typical metabolomics workflow, in which peaks are identified in the chromatographic (time) dimension, in direct injection mass spec data sets peaks are identified in the m/z dimension. <em><a href="https://bioconductor.org/packages/3.13/xcms" class="external-link">xcms</a></em> uses functionality from the <code>MassSpecWavelet</code> package to identify such peaks.</p>
<p>Below we load the required packages. For information on the parallel processing setup please see the <code>BiocParallel</code> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MassSpecWavelet</span><span class="op">)</span>

<span class="fu">register</span><span class="op">(</span><span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In this documentation we use an example data set from the <em><a href="https://bioconductor.org/packages/3.13/msdata" class="external-link">msdata</a></em> package. Assuming that <em><a href="https://bioconductor.org/packages/3.13/msdata" class="external-link">msdata</a></em> is installed, we locate the path of the package and load the data set. We create also a <code>data.frame</code> describing the experimental setup based on the file names.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mzdata_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"fticr"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span>
<span class="va">mzdata_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">mzdata_path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## We're subsetting to 2 samples per condition</span>
<span class="va">mzdata_files</span> <span class="op">&lt;-</span> <span class="va">mzdata_files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">]</span>

<span class="co">## Create a data.frame assigning samples to sample groups, i.e. ham4 and ham5.</span>
<span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"ham4"</span>, <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/pSet-class.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzdata_files</span><span class="op">)</span><span class="op">)</span>
<span class="va">grp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">mzdata_files</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"^HAM005"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ham5"</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">mzdata_files</span><span class="op">)</span>, sample_group <span class="op">=</span> <span class="va">grp</span><span class="op">)</span>

<span class="co">## Load the data.</span>
<span class="va">ham_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/readMSData.html" class="external-link">readMSData</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">mzdata_files</span>,
                      pdata <span class="op">=</span> <span class="fu">new</span><span class="op">(</span><span class="st">"NAnnotatedDataFrame"</span>, <span class="va">pd</span><span class="op">)</span>,
                      mode <span class="op">=</span> <span class="st">"onDisk"</span><span class="op">)</span></code></pre></div>
<p>The data files are from <em>direct injection</em> mass spectrometry experiments, i.e.Â we have only a single spectrum available for each sample and no retention times.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Only a single spectrum with an *artificial* retention time is available</span>
<span class="co">## for each sample</span>
<span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">ham_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## F1.S1 F2.S1 F3.S1 F4.S1 
##     1     1     1     1</code></pre>
<p>Peaks are identified within each spectrum using the <em>mass spec wavelet</em> method.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define the parameters for the peak detection</span>
<span class="va">msw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findPeaks-MSW.html">MSWParam</a></span><span class="op">(</span>scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">9</span><span class="op">)</span>, nearbyPeak <span class="op">=</span> <span class="cn">TRUE</span>, winSize.noise <span class="op">=</span> <span class="fl">500</span>,
                SNR.method <span class="op">=</span> <span class="st">"data.mean"</span>, snthresh <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">ham_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chromatographic-peak-detection.html">findChromPeaks</a></span><span class="op">(</span><span class="va">ham_raw</span>, param <span class="op">=</span> <span class="va">msw</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##            mz    mzmin    mzmax rt rtmin rtmax    into     maxo       sn intf
## CP01 403.2367 403.2279 403.2447 -1    -1    -1 4735258 372259.4 22.97534   NA
## CP02 409.1845 409.1747 409.1936 -1    -1    -1 4158404 310572.1 20.61382   NA
## CP03 413.2677 413.2585 413.2769 -1    -1    -1 6099006 435462.6 27.21723   NA
## CP04 423.2363 423.2266 423.2459 -1    -1    -1 2708391 174252.7 14.74527   NA
## CP05 427.2681 427.2574 427.2779 -1    -1    -1 6302089 461385.6 32.50050   NA
## CP06 437.2375 437.2254 437.2488 -1    -1    -1 7523070 517917.6 34.37645   NA
##           maxf sample
## CP01  814693.1      1
## CP02  732119.9      1
## CP03 1018994.8      1
## CP04  435858.5      1
## CP05 1125644.3      1
## CP06 1282906.5      1</code></pre>
</div>
<div id="calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#calibration" class="anchor"></a>Calibration</h1>
<p>The <code>calibrate</code> method can be used to correct the m/z values of identified peaks. The currently implemented method requires identified peaks and a list of m/z values for known calibrants. The identified peaks m/z values are then adjusted based on the differences between the calibrantsâ€™ m/z values and the m/z values of the closest peaks (within a user defined permitted maximal distance). Note that this method does presently only calibrate identified peaks, but not the original m/z values in the spectra.</p>
<p>Below we demonstrate the <code>calibrate</code> method on one of the data files with artificially defined calibration m/z values. We first subset the data set to the first data file, extract the m/z values of 3 peaks and modify the values slightly.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Subset to the first file.</span>
<span class="va">first_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/MSnExp-class.html" class="external-link">filterFile</a></span><span class="op">(</span><span class="va">ham_prep</span>, file <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co">## Extract 3 m/z values</span>
<span class="va">calib_mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>, <span class="st">"mz"</span><span class="op">]</span>
<span class="va">calib_mz</span> <span class="op">&lt;-</span> <span class="va">calib_mz</span> <span class="op">+</span> <span class="fl">0.00001</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.4</span><span class="op">)</span> <span class="op">*</span> <span class="va">calib_mz</span> <span class="op">+</span> <span class="fl">0.0001</span></code></pre></div>
<p>Next we calibrate the data set using the previously defined <em>artificial</em> calibrants. We are using the <code>"edgeshift"</code> method for calibration that adjusts all peaks within the range of the m/z values of the calibrants using a linear interpolation and shifts all chromatographic peaks outside of that range by a constant factor (the difference between the lowest respectively largest calibrant m/z with the closest peakâ€™s m/z). Note that in a <em>real</em> use case, the m/z values would obviously represent known m/z of calibrants and would not be defined on the actual data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set-up the parameter class for the calibration</span>
<span class="va">prm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalibrantMassParam-class.html">CalibrantMassParam</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="va">calib_mz</span>, method <span class="op">=</span> <span class="st">"edgeshift"</span>,
                          mzabs <span class="op">=</span> <span class="fl">0.0001</span>, mzppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">first_file_calibrated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate-methods.html">calibrate</a></span><span class="op">(</span><span class="va">first_file</span>, param <span class="op">=</span> <span class="va">prm</span><span class="op">)</span></code></pre></div>
<p>To evaluate the calibration we plot below the difference between the adjusted and raw m/z values (y-axis) against the raw m/z values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file_calibrated</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mz"</span><span class="op">]</span> <span class="op">-</span>
    <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mz"</span><span class="op">]</span>

<span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/plot-methods.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mz"</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">z</span><span class="op">[</span><span class="va">raw</span><span class="op">]</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">diffs</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">z</span><span class="op">[</span><span class="va">calibrated</span><span class="op">]</span> <span class="op">-</span> <span class="va">m</span><span class="op">/</span><span class="va">z</span><span class="op">[</span><span class="va">raw</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="xcms-direct-injection_files/figure-html/calibrationresult-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="correspondence" class="section level1">
<h1 class="hasAnchor">
<a href="#correspondence" class="anchor"></a>Correspondence</h1>
<p>Correspondence aims to group peaks across samples to define the <em>features</em> (ions with the same m/z values). Peaks from single spectrum, direct injection MS experiments can be grouped with the <em>MZclust</em> method. Below we perform the correspondence analysis with the <code>groupChromPeaks</code> method using default settings.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Using default settings but define sample group assignment</span>
<span class="va">mzc_prm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/groupChromPeaks-mzClust.html">MzClustParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="va">ham_prep</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span>
<span class="va">ham_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/groupChromPeaks.html">groupChromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span>, param <span class="op">=</span> <span class="va">mzc_prm</span><span class="op">)</span></code></pre></div>
<p>Getting an overview of the performed processings:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ham_prep</span></code></pre></div>
<pre><code>## MSn experiment data ("XCMSnExp")
## Object size in memory: 0.04 Mb
## - - - Spectra data - - -
##  MS level(s): 1 
##  Number of spectra: 4 
##  MSn retention times: 0:01 - 0:01 minutes
## - - - Processing information - - -
## Data loaded [Fri Feb 26 17:47:52 2021] 
##  MSnbase version: 2.17.8 
## - - - Meta data  - - -
## phenoData
##   rowNames: 1 2 3 4
##   varLabels: filename sample_group
##   varMetadata: labelDescription
## Loaded from:
##   [1] HAM004_641fE_14-11-07--Exp1.extracted.mzdata...  [4] HAM005_641fE_14-11-07--Exp2.extracted.mzdata
##   Use 'fileNames(.)' to see all files.
## protocolData: none
## featureData
##   featureNames: F1.S1 F2.S1 F3.S1 F4.S1
##   fvarLabels: fileIdx spIdx ... spectrum (35 total)
##   fvarMetadata: labelDescription
## experimentData: use 'experimentData(object)'
## - - - xcms preprocessing - - -
## Chromatographic peak detection:
##  method: MSW 
##  38 peaks identified in 4 samples.
##  On average 9.5 chromatographic peaks per sample.
## Correspondence:
##  method: mzClust 
##  20 features identified.
##  Median mz range of features: 9.1553e-05
##  Median rt range of features: 0</code></pre>
<p>The peak group information, i.e.Â the <em>feature</em> definitions can be accessed with the <code>featureDefinitions</code> method.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/XCMSnExp-class.html">featureDefinitions</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span></code></pre></div>
<pre><code>## DataFrame with 20 rows and 10 columns
##          mzmed     mzmin     mzmax     rtmed     rtmin     rtmax    npeaks
##      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;
## FT01   402.285   402.285   402.286        -1        -1        -1         2
## FT02   403.237   403.237   403.237        -1        -1        -1         4
## FT03   405.109   405.109   405.109        -1        -1        -1         2
## FT04   409.184   409.184   409.185        -1        -1        -1         2
## FT05   410.144   410.144   410.145        -1        -1        -1         2
## ...        ...       ...       ...       ...       ...       ...       ...
## FT16   437.238   437.238   437.238        -1        -1        -1         2
## FT17   438.240   438.240   438.240        -1        -1        -1         2
## FT18   439.151   439.151   439.151        -1        -1        -1         2
## FT19   441.130   441.130   441.131        -1        -1        -1         2
## FT20   445.293   445.292   445.293        -1        -1        -1         2
##           ham4      ham5     peakidx
##      &lt;numeric&gt; &lt;numeric&gt;      &lt;list&gt;
## FT01         0         2       16,28
## FT02         2         2 17,29,1,...
## FT03         0         2       18,30
## FT04         2         0        10,2
## FT05         0         2       19,31
## ...        ...       ...         ...
## FT16         2         0        6,13
## FT17         2         0        7,14
## FT18         0         2       26,37
## FT19         0         2       38,27
## FT20         2         0        15,8</code></pre>
<p>Plotting the raw data for direct injection samples involves a little more processing than for LC/GC-MS data in which we can simply use the <code>chromatogram</code> method to extract the data. Below we extract the m/z-intensity pairs for the peaks associated with the first feature. We thus first identify the peaks for that feature and define their m/z values range. Using this range we can subsequently use the <code>filterMz</code> function to sub-set the full data set to the signal associated with the featureâ€™s peaks. On that object we can then call the <code>mz</code> and <code>intensity</code> functions to extract the data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Get the peaks belonging to the first feature</span>
<span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="../reference/XCMSnExp-class.html">featureDefinitions</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span><span class="op">$</span><span class="va">peakidx</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span>

<span class="co">## Define the m/z range</span>
<span class="va">mzr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pks</span><span class="op">[</span>, <span class="st">"mzmin"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.001</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pks</span><span class="op">[</span>, <span class="st">"mzmax"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">)</span>

<span class="co">## Subset the object to the m/z range</span>
<span class="va">ham_prep_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/trimMz-methods.html" class="external-link">filterMz</a></span><span class="op">(</span><span class="va">ham_prep</span>, mz <span class="op">=</span> <span class="va">mzr</span><span class="op">)</span>

<span class="co">## Extract the mz and intensity values</span>
<span class="va">mzs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">ham_prep_sub</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">ham_prep_sub</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Plot the data</span>
<span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/plot-methods.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, pch <span class="op">=</span> <span class="cn">NA</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ints</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"FT01"</span>,
     xlab <span class="op">=</span> <span class="st">"m/z"</span>, ylab <span class="op">=</span> <span class="st">"intensity"</span><span class="op">)</span>
<span class="co">## Define colors</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"#ff000080"</span>, <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/pSet-class.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span><span class="op">[</span><span class="va">ham_prep_sub</span><span class="op">$</span><span class="va">sample_group</span> <span class="op">==</span> <span class="st">"ham5"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#0000ff80"</span>
<span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">mzs</span>, <span class="va">ints</span>, <span class="va">cols</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">col</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, col <span class="op">=</span> <span class="va">col</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p><img src="xcms-direct-injection_files/figure-html/feature1-1.png" width="576" style="display: block; margin: auto;"></p>
<p>To access the actual intensity values of each feature in each sample the <code>featureValue</code> method can be used. The setting <code>value = "into"</code> tells the function to return the integrated signal for each peak (one representative peak) per sample.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">feat_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantify,XCMSnExp-method.html">featureValues</a></span><span class="op">(</span><span class="va">ham_prep</span>, value <span class="op">=</span> <span class="st">"into"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">feat_vals</span><span class="op">)</span></code></pre></div>
<pre><code>##      HAM004_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                           NA
## FT02                                      4735258
## FT03                                           NA
## FT04                                      4158404
## FT05                                           NA
## FT06                                      6099006
##      HAM004_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                           NA
## FT02                                      6202418
## FT03                                           NA
## FT04                                      5004546
## FT05                                           NA
## FT06                                      4950642
##      HAM005_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                      4095293
## FT02                                      4811391
## FT03                                      2982453
## FT04                                           NA
## FT05                                      2872023
## FT06                                           NA
##      HAM005_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                      4804763
## FT02                                      2581183
## FT03                                      2268984
## FT04                                           NA
## FT05                                      2133219
## FT06                                           NA</code></pre>
<p><code>NA</code> is reported for features in samples for which no peak was identified at the featureâ€™s m/z value. In some instances there might still be a signal at the featureâ€™s position in the raw data files, but the peak detection failed to identify a peak. For these cases signal can be recovered using the <code>fillChromPeaks</code> method that integrates all raw signal at the featureâ€™s location. If there is no signal at that location an <code>NA</code> is reported.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ham_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FillChromPeaksParam-class.html">fillChromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span>, param <span class="op">=</span> <span class="fu"><a href="../reference/FillChromPeaksParam-class.html">FillChromPeaksParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/quantify,XCMSnExp-method.html">featureValues</a></span><span class="op">(</span><span class="va">ham_prep</span>, value <span class="op">=</span> <span class="st">"into"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##      HAM004_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                     768754.0
## FT02                                    4735257.5
## FT03                                     652566.6
## FT04                                    4158404.5
## FT05                                     652201.1
## FT06                                    6099006.3
##      HAM004_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                    1230140.4
## FT02                                    6202417.6
## FT03                                     374109.9
## FT04                                    5004546.3
## FT05                                     403448.4
## FT06                                    4950641.7
##      HAM005_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                      4095293
## FT02                                      4811391
## FT03                                      2982453
## FT04                                      1221031
## FT05                                      2872023
## FT06                                      1573988
##      HAM005_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                    4804762.5
## FT02                                    2581183.1
## FT03                                    2268984.5
## FT04                                    1241294.4
## FT05                                    2133219.4
## FT06                                     977694.5</code></pre>
</div>
<div id="further-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#further-analysis" class="anchor"></a>Further analysis</h1>
<p>Further analysis, i.e.Â detection of features/metabolites with significantly different abundances, or PCA analyses can be performed on the feature matrix using functionality from other R packages, such as <em><a href="https://bioconductor.org/packages/3.13/limma" class="external-link">limma</a></em>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steffen Neumann.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
